import{A as J,G as K,H as Q,I as U,b as D,c as M,d as N,e as j,f as F,q as L,x as z,y as G,z as H}from"./chunk-B22K5UZQ.js";import{$a as u,Bb as V,Ca as o,Da as v,Gb as m,Hb as d,Ib as k,La as R,O as h,Za as c,a as P,bb as l,db as A,eb as O,fa as x,fb as s,g as T,ga as g,gb as _,hb as y,ib as w,jb as f,m as B,nb as b,ob as a,p as E,q as $,w as S,wb as I,x as q,xb as r,zb as C}from"./chunk-QMICDKEG.js";import"./chunk-4CLCTAJ7.js";var X=(e,i)=>i.id;function Y(e,i){if(e&1&&(r(0),m(1,"titlecase")),e&2){let t=a(3);C(" ",d(1,1,t.queryParams.brewery_type)," ")}}function Z(e,i){e&1&&r(0," Near Me ")}function ee(e,i){if(e&1&&r(0),e&2){let t=a(3);C(" named ",t.queryParams.name," ")}}function te(e,i){e&1&&r(0," in ")}function ie(e,i){if(e&1&&(r(0),m(1,"titlecase")),e&2){let t=a(3);C(" ",d(1,1,t.queryParams.city),", ")}}function ne(e,i){if(e&1&&(r(0),m(1,"titlecase")),e&2){let t=a(3);C(" ",d(1,1,t.queryParams.state)," ")}}function oe(e,i){if(e&1){let t=f();s(0,"button",7),b("click",function(){x(t);let p=a(5);return g(p.previousPage())}),r(1,"\xAB Previous"),_()}}function ae(e,i){if(e&1){let t=f();s(0,"button",7),b("click",function(){x(t);let p=a(5);return g(p.nextPage())}),r(1,"Next \xBB"),_()}}function re(e,i){if(e&1&&(s(0,"div",4)(1,"div",5),c(2,oe,2,0,"button",6),m(3,"async"),_(),s(4,"div",5),r(5),m(6,"number"),m(7,"number"),m(8,"number"),_(),s(9,"div",5),c(10,ae,2,0,"button",6),m(11,"async"),_()()),e&2){let t=a(4);o(2),l(d(3,5,t.currentPage$)!==1?2:-1),o(3),V(" ",d(6,7,t.start)," - ",d(7,9,t.end)," of ",d(8,11,t.total)," breweries "),o(5),l(d(11,13,t.currentPage$)!==t.totalPages?10:-1)}}function le(e,i){e&1&&w(0)}function ce(e,i){if(e&1&&(s(0,"div",3),y(1,"brew-brewery",8),_()),e&2){let t=i.$implicit;o(),u("brewery",t)}}function se(e,i){e&1&&w(0)}function _e(e,i){if(e&1&&(c(0,re,12,15,"ng-template",null,0,k)(2,le,1,0,"ng-container",1),s(3,"div",2),A(4,ce,2,1,"div",3,X),_(),c(6,se,1,0,"ng-container",1)),e&2){let t=I(1),n=a(2);o(2),u("ngTemplateOutlet",t),o(2),O(n),o(2),u("ngTemplateOutlet",t)}}function pe(e,i){e&1&&(s(0,"p"),r(1,"No breweries found."),_())}function me(e,i){if(e&1&&(s(0,"h1"),c(1,Y,2,3),r(2," Breweries "),c(3,Z,1,0)(4,ee,1,1)(5,te,1,0)(6,ie,2,3)(7,ne,2,3),_(),c(8,_e,7,2)(9,pe,2,0,"p")),e&2){let t=a(),n=a();o(),l(n.queryParams.brewery_type?1:-1),o(2),l(n.queryParams.dist?3:-1),o(),l(n.queryParams.name?4:-1),o(),l(n.queryParams.city||n.queryParams.state?5:-1),o(),l(n.queryParams.city?6:-1),o(),l(n.queryParams.state?7:-1),o(),l(t.length>0?8:9)}}function de(e,i){if(e&1&&c(0,me,10,7),e&2){let t=a();l(t.loadingError?-1:0)}}function ue(e,i){e&1&&y(0,"brew-loading",9)}function Ce(e,i){if(e&1){let t=f();s(0,"p")(1,"clr-alert",10)(2,"clr-alert-item")(3,"span",11),r(4," There was an issue loading brewery data. Please try again. "),_(),s(5,"div",12)(6,"button",13),b("click",function(){x(t);let p=a(2);return g(p.getBreweries())}),r(7,"Retry"),_()()()()()}e&2&&(o(),u("clrAlertClosable",!1)("clrAlertType","danger"))}function he(e,i){if(e&1&&c(0,ue,1,0,"brew-loading",9)(1,Ce,8,2,"p"),e&2){let t=a();l(t.loadingError?1:0)}}var W=class e{constructor(i,t){this.breweriesSvc=i;this.route=t}subscription=new P;currentPage$=new T(1);end;loading;loadingError;paginatedSearchResults$;perPage=50;searchResults$;start;total;totalPages;queryParams;ngOnInit(){this.getRouteParams(),this.getBreweries(),this.searchResults$=this.breweriesSvc.searchResults$.pipe(S(i=>!!i),h(i=>this.total=i.length)),this.paginatedSearchResults$=$([this.searchResults$.pipe(S(i=>!!i)),this.currentPage$]).pipe(E(([i,t])=>{let n=(t-1)*this.perPage,p=n+this.perPage;return this.start=n+1,this.end=Math.min(p,this.total),this.totalPages=Math.ceil(this.total/this.perPage),i.slice(n,p)}))}ngOnDestroy(){this.subscription.unsubscribe()}getRouteParams(){let i=this.route.queryParams.pipe(h(t=>{this.queryParams=t,this.breweriesSvc.changeSearchCriteria(this.queryParams)})).subscribe();this.subscription.add(i)}getBreweries(){this.loading=!0,this.loadingError=!1;let i=this.breweriesSvc.getBreweries().pipe(h(()=>{this.loading=!1,this.breweriesSvc.changeSearchCriteria(this.queryParams)}),q(t=>(this.loading=!1,this.loadingError=!0,B(()=>new Error(t.message))))).subscribe();this.subscription.add(i)}nextPage(){this.currentPage$.next(this.currentPage$.getValue()+1)}previousPage(){this.currentPage$.getValue()>1&&this.currentPage$.next(this.currentPage$.getValue()-1)}static \u0275fac=function(t){return new(t||e)(v(K),v(L))};static \u0275cmp=R({type:e,selectors:[["brew-search"]],decls:3,vars:3,consts:[["pagination",""],[4,"ngTemplateOutlet"],[1,"clr-row"],[1,"clr-col-sm-12","clr-col-md-6","clr-col-lg-4","clr-col-xl-3"],[1,"clr-row","clr-align-items-center","clr-justify-content-center",2,"margin-top","1.2rem"],[1,"clr-col-sm-12","clr-col-md-auto","text-center"],[1,"btn","btn-link","btn-sm"],[1,"btn","btn-link","btn-sm",3,"click"],[3,"brewery"],["text","Searching"],[3,"clrAlertClosable","clrAlertType"],[1,"alert-text"],[1,"alert-actions"],[1,"btn","btn-danger","btn-sm",2,"margin","0",3,"click"]],template:function(t,n){if(t&1&&(c(0,de,1,1),m(1,"async"),c(2,he,2,1)),t&2){let p;l((p=d(1,1,n.paginatedSearchResults$))?0:2,p)}},dependencies:[Q,J,z,G,H,F,D,M,j,N,U],encapsulation:2})};export{W as SearchComponent};
